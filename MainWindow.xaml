<Window x:Class="Sowser.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        Title="Sowser" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        TextElement.Foreground="#FFFFFF"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        FontFamily="Segoe UI">
    
    <Window.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#1a1a2e" Offset="0"/>
            <GradientStop Color="#16213e" Offset="0.5"/>
            <GradientStop Color="#0f3460" Offset="1"/>
        </LinearGradientBrush>
    </Window.Background>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="60"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Left Sidebar - Glass -->
        <Border Grid.Column="0" Background="#20FFFFFF" BorderBrush="#30FFFFFF" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Logo -->
                <Button Grid.Row="0" Style="{StaticResource MaterialDesignIconButton}" 
                        Margin="0,16,0,8" Width="40" Height="40"
                        Foreground="#00D9FF" Click="NewCard_Click" ToolTip="New Card">
                    <materialDesign:PackIcon Kind="Web" Width="26" Height="26"/>
                </Button>
                
                <!-- Main Nav Icons -->
                <StackPanel Grid.Row="1" VerticalAlignment="Top" Margin="0,8,0,0">
                    <Button Style="{StaticResource MaterialDesignIconButton}" 
                            Width="44" Height="44" Margin="0,4"
                            Foreground="#80FFFFFF" Click="ToggleBookmarks_Click" ToolTip="Bookmarks">
                        <materialDesign:PackIcon Kind="StarOutline" Width="22" Height="22"/>
                    </Button>
                    <Button Style="{StaticResource MaterialDesignIconButton}" 
                            Width="44" Height="44" Margin="0,4"
                            Foreground="#80FFFFFF" Click="ToggleHistory_Click" ToolTip="History">
                        <materialDesign:PackIcon Kind="History" Width="22" Height="22"/>
                    </Button>
                    <Button Style="{StaticResource MaterialDesignIconButton}" 
                            Width="44" Height="44" Margin="0,4"
                            Foreground="#80FFFFFF" Click="ToggleDownloads_Click" ToolTip="Downloads">
                        <materialDesign:PackIcon Kind="Download" Width="22" Height="22"/>
                    </Button>
                    <Button Style="{StaticResource MaterialDesignIconButton}" 
                            Width="44" Height="44" Margin="0,4"
                            Foreground="#80FFFFFF" Click="FitAllCards_Click" ToolTip="Fit All">
                        <materialDesign:PackIcon Kind="FitToScreen" Width="22" Height="22"/>
                    </Button>
                    <Button Style="{StaticResource MaterialDesignIconButton}" 
                            Width="44" Height="44" Margin="0,4"
                            Foreground="#80FFFFFF" Click="ResetView_Click" ToolTip="Reset View">
                        <materialDesign:PackIcon Kind="Restore" Width="22" Height="22"/>
                    </Button>
                </StackPanel>
                
                <!-- Bottom Icons -->
                <StackPanel Grid.Row="2" VerticalAlignment="Bottom" Margin="0,0,0,16">
                    <Button Style="{StaticResource MaterialDesignIconButton}" 
                            Width="44" Height="44" Margin="0,4"
                            Foreground="#80FFFFFF" Click="ToggleSettings_Click" ToolTip="Settings">
                        <materialDesign:PackIcon Kind="CogOutline" Width="22" Height="22"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Top Toolbar -->
            <Border Grid.Row="0" Background="#15FFFFFF" BorderBrush="#25FFFFFF" BorderThickness="0,0,0,1">
                <StackPanel HorizontalAlignment="Center" Margin="20,16,20,12">
                    <!-- Search Bar -->
                    <Border HorizontalAlignment="Center" Width="500"
                            Background="#20FFFFFF" CornerRadius="24" Padding="0"
                            BorderBrush="#30FFFFFF" BorderThickness="1">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <materialDesign:PackIcon Kind="Magnify" Grid.Column="0" 
                                                     Width="18" Height="18"
                                                     VerticalAlignment="Center" Margin="16,0,8,0"
                                                     Foreground="#80FFFFFF"/>
                            <TextBox x:Name="MainUrlBar" Grid.Column="1" 
                                     BorderThickness="0" Background="Transparent"
                                     VerticalContentAlignment="Center"
                                     Padding="0,12,16,12" FontSize="14"
                                     Foreground="#FFFFFF"
                                     CaretBrush="#FFFFFF"
                                     KeyDown="MainUrlBar_KeyDown"
                                     materialDesign:HintAssist.Hint="Search or enter URL..."
                                     materialDesign:HintAssist.Foreground="#70FFFFFF"/>
                        </Grid>
                    </Border>
                    
                    <!-- Quick Links -->
                    <StackPanel HorizontalAlignment="Center" Orientation="Horizontal" Margin="0,14,0,0">
                        <Border Background="#18FFFFFF" CornerRadius="16" Margin="4,0" 
                                BorderBrush="#25FFFFFF" BorderThickness="1" Cursor="Hand"
                                MouseLeftButtonDown="QuickLinkBorder_Click" Tag="https://youtube.com">
                            <StackPanel Orientation="Horizontal" Margin="12,6">
                                <Ellipse Width="10" Height="10" Fill="#FF4757" Margin="0,0,8,0"/>
                                <TextBlock Text="YouTube" Foreground="#E0FFFFFF" FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#18FFFFFF" CornerRadius="16" Margin="4,0" 
                                BorderBrush="#25FFFFFF" BorderThickness="1" Cursor="Hand"
                                MouseLeftButtonDown="QuickLinkBorder_Click" Tag="https://chat.openai.com">
                            <StackPanel Orientation="Horizontal" Margin="12,6">
                                <Ellipse Width="10" Height="10" Fill="#2ED573" Margin="0,0,8,0"/>
                                <TextBlock Text="ChatGPT" Foreground="#E0FFFFFF" FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#18FFFFFF" CornerRadius="16" Margin="4,0" 
                                BorderBrush="#25FFFFFF" BorderThickness="1" Cursor="Hand"
                                MouseLeftButtonDown="QuickLinkBorder_Click" Tag="https://amazon.com">
                            <StackPanel Orientation="Horizontal" Margin="12,6">
                                <Ellipse Width="10" Height="10" Fill="#FFA502" Margin="0,0,8,0"/>
                                <TextBlock Text="Amazon" Foreground="#E0FFFFFF" FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#18FFFFFF" CornerRadius="16" Margin="4,0" 
                                BorderBrush="#25FFFFFF" BorderThickness="1" Cursor="Hand"
                                MouseLeftButtonDown="QuickLinkBorder_Click" Tag="https://docs.google.com">
                            <StackPanel Orientation="Horizontal" Margin="12,6">
                                <Ellipse Width="10" Height="10" Fill="#3742FA" Margin="0,0,8,0"/>
                                <TextBlock Text="Google Docs" Foreground="#E0FFFFFF" FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#18FFFFFF" CornerRadius="16" Margin="4,0" 
                                BorderBrush="#25FFFFFF" BorderThickness="1" Cursor="Hand"
                                MouseLeftButtonDown="QuickLinkBorder_Click" Tag="https://netflix.com">
                            <StackPanel Orientation="Horizontal" Margin="12,6">
                                <Ellipse Width="10" Height="10" Fill="#E84393" Margin="0,0,8,0"/>
                                <TextBlock Text="Netflix" Foreground="#E0FFFFFF" FontSize="12"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#18FFFFFF" CornerRadius="16" Margin="4,0" 
                                BorderBrush="#25FFFFFF" BorderThickness="1" Cursor="Hand"
                                MouseLeftButtonDown="QuickLinkBorder_Click" Tag="https://github.com">
                            <StackPanel Orientation="Horizontal" Margin="12,6">
                                <Ellipse Width="10" Height="10" Fill="#A0A0A0" Margin="0,0,8,0"/>
                                <TextBlock Text="GitHub" Foreground="#E0FFFFFF" FontSize="12"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Canvas Area -->
            <Grid Grid.Row="1">
                <!-- Sidebar Panel (slides over canvas) -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Sidebar Content -->
                    <Border x:Name="SidebarPanel" Grid.Column="0" Width="280"
                            Background="#25FFFFFF" BorderBrush="#30FFFFFF" BorderThickness="0,0,1,0"
                            Visibility="Collapsed">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Sidebar Header -->
                            <Border Grid.Row="0" Padding="16,14" 
                                    BorderBrush="#20FFFFFF" BorderThickness="0,0,0,1">
                                <Grid>
                                    <TextBlock x:Name="SidebarTitle" Text="Bookmarks" 
                                               FontSize="16" FontWeight="SemiBold" Foreground="#FFFFFF"/>
                                    <Button HorizontalAlignment="Right" Click="CloseSidebar_Click"
                                            Style="{StaticResource MaterialDesignIconButton}"
                                            Width="28" Height="28" Foreground="#80FFFFFF">
                                        <materialDesign:PackIcon Kind="Close" Width="16" Height="16"/>
                                    </Button>
                                </Grid>
                            </Border>
                            
                            <!-- Sidebar Content Panels -->
                            <Grid Grid.Row="1">
                                <ScrollViewer x:Name="BookmarksPanel" Visibility="Collapsed">
                                    <StackPanel x:Name="BookmarksList" Margin="12"/>
                                </ScrollViewer>
                                
                                <Grid x:Name="HistoryPanel" Visibility="Collapsed">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Border Grid.Row="0" Margin="12" Background="#20FFFFFF" CornerRadius="8" BorderBrush="#30FFFFFF" BorderThickness="1">
                                        <Grid>
                                            <materialDesign:PackIcon Kind="Magnify" Width="16" Height="16"
                                                                     VerticalAlignment="Center" Margin="10,0,0,0"
                                                                     Foreground="#80FFFFFF"/>
                                            <TextBox x:Name="HistorySearchBox" 
                                                     BorderThickness="0" Background="Transparent"
                                                     Padding="32,8,12,8" FontSize="13"
                                                     Foreground="#FFFFFF" CaretBrush="#FFFFFF"
                                                     materialDesign:HintAssist.Hint="Search history..."
                                                     materialDesign:HintAssist.Foreground="#60FFFFFF"
                                                     TextChanged="HistorySearchBox_TextChanged"/>
                                        </Grid>
                                    </Border>
                                    <ScrollViewer Grid.Row="1">
                                        <StackPanel x:Name="HistoryList" Margin="12,0,12,12"/>
                                    </ScrollViewer>
                                </Grid>
                                
                                <ScrollViewer x:Name="DownloadsPanel" Visibility="Collapsed">
                                    <StackPanel x:Name="DownloadsList" Margin="12"/>
                                </ScrollViewer>
                                
                                <ScrollViewer x:Name="SettingsPanel" Visibility="Collapsed">
                                    <StackPanel Margin="16">
                                        <TextBlock Text="Search Engine" FontWeight="Medium" 
                                                   Foreground="#FFFFFF" Margin="0,0,0,8"/>
                                        <ComboBox x:Name="SearchEngineCombo" SelectedIndex="0" Margin="0,0,0,20"
                                                  SelectionChanged="SearchEngineCombo_SelectionChanged"
                                                  Foreground="#FFFFFF">
                                            <ComboBoxItem Content="Google"/>
                                            <ComboBoxItem Content="Bing"/>
                                            <ComboBoxItem Content="DuckDuckGo"/>
                                        </ComboBox>
                                        
                                        <CheckBox x:Name="AutoSaveToggle" Content="Auto-save workspace" 
                                                  IsChecked="True" Margin="0,0,0,20" Foreground="#FFFFFF"
                                                  Checked="AutoSaveCheckbox_Changed" Unchecked="AutoSaveCheckbox_Changed"/>
                                        
                                        <Button Content="Save Workspace" Click="SaveWorkspace_Click"
                                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                                Foreground="#00D9FF" BorderBrush="#00D9FF"
                                                HorizontalAlignment="Stretch" Margin="0,0,0,8"/>
                                        <Button Content="Load Workspace" Click="LoadWorkspace_Click"
                                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                                Foreground="#00D9FF" BorderBrush="#00D9FF"
                                                HorizontalAlignment="Stretch"/>
                                    </StackPanel>
                                </ScrollViewer>
                            </Grid>
                        </Grid>
                    </Border>

                    <!-- Canvas -->
                    <Grid Grid.Column="1">
                        <!-- Scrollable Canvas -->
                        <ScrollViewer x:Name="CanvasScrollViewer"
                                      HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto"
                                      Background="Transparent"
                                      PanningMode="Both"
                                      PreviewMouseWheel="CanvasScrollViewer_PreviewMouseWheel"
                                      PreviewMouseDown="CanvasScrollViewer_PreviewMouseDown"
                                      PreviewMouseMove="CanvasScrollViewer_PreviewMouseMove"
                                      PreviewMouseUp="CanvasScrollViewer_PreviewMouseUp">
                            
                            <Grid x:Name="CanvasContainer">
                                <!-- Scaled layer for connections and grid -->
                                <Grid>
                                    <Grid.LayoutTransform>
                                        <ScaleTransform x:Name="CanvasScale" ScaleX="1" ScaleY="1"/>
                                    </Grid.LayoutTransform>
                                    
                                    <!-- Connection Lines Canvas -->
                                    <Canvas x:Name="ConnectionsCanvas" Width="3000" Height="2000"/>
                                </Grid>
                                
                                <!-- Unscaled layer for cards - positioned manually based on zoom -->
                                <Canvas x:Name="CardsCanvas" Width="3000" Height="2000" Background="Transparent">
                                    <Canvas.LayoutTransform>
                                        <ScaleTransform x:Name="CardsCanvasScale" ScaleX="1" ScaleY="1"/>
                                    </Canvas.LayoutTransform>
                                </Canvas>
                            </Grid>
                        </ScrollViewer>
                        
                        <!-- Floating Zoom Controls -->
                        <Border HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                Margin="16" CornerRadius="12"
                                Background="#30FFFFFF" BorderBrush="#40FFFFFF" BorderThickness="1">
                            <StackPanel Orientation="Horizontal" Margin="4">
                                <Button Click="ZoomOut_Click" ToolTip="Zoom Out"
                                        Style="{StaticResource MaterialDesignIconButton}"
                                        Width="32" Height="32" Foreground="#CCFFFFFF">
                                    <materialDesign:PackIcon Kind="Minus" Width="18" Height="18"/>
                                </Button>
                                <Border Width="50">
                                    <TextBlock x:Name="ZoomIndicator" Text="100%" 
                                               FontSize="12" Foreground="#CCFFFFFF"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               MouseLeftButtonDown="ZoomIndicator_Click" Cursor="Hand"
                                               ToolTip="Click to reset"/>
                                </Border>
                                <Button Click="ZoomIn_Click" ToolTip="Zoom In"
                                        Style="{StaticResource MaterialDesignIconButton}"
                                        Width="32" Height="32" Foreground="#CCFFFFFF">
                                    <materialDesign:PackIcon Kind="Plus" Width="18" Height="18"/>
                                </Button>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>
            </Grid>
        </Grid>
        
        <!-- Expanded Card Overlay (covers the main content area) -->
        <Grid x:Name="ExpandedCardOverlay" Grid.Column="1" Visibility="Collapsed">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#1a1a2e" Offset="0"/>
                    <GradientStop Color="#16213e" Offset="0.5"/>
                    <GradientStop Color="#0f3460" Offset="1"/>
                </LinearGradientBrush>
            </Grid.Background>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Header with close button -->
            <Border Grid.Row="0" Background="#20FFFFFF" BorderBrush="#30FFFFFF" BorderThickness="0,0,0,1" Padding="12,8">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <materialDesign:PackIcon Kind="Web" Width="18" Height="18" Foreground="#80FFFFFF" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock x:Name="ExpandedCardUrl" FontSize="13" Foreground="#FFFFFF" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                    </StackPanel>
                    <Button HorizontalAlignment="Right" Click="CloseExpandedCard_Click"
                            Style="{StaticResource MaterialDesignIconButton}"
                            Width="32" Height="32" Foreground="#CCFFFFFF" ToolTip="Close (Esc)">
                        <materialDesign:PackIcon Kind="Close" Width="20" Height="20"/>
                    </Button>
                </Grid>
            </Border>
            
            <!-- WebView2 Content -->
            <wv2:WebView2 x:Name="ExpandedWebView" Grid.Row="1"/>
        </Grid>
    </Grid>
</Window>
