<UserControl x:Class="Sowser.Controls.BrowserCard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
             xmlns:local="clr-namespace:Sowser.Controls"
             Width="700" Height="500" MinWidth="350" MinHeight="250"
             MouseEnter="Card_MouseEnter"
             MouseLeave="Card_MouseLeave">
    
    <Grid>
        <!-- Card Shadow with glow effect -->
        <Border Margin="12" CornerRadius="16">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#30FFFFFF" Offset="0"/>
                    <GradientStop Color="#15FFFFFF" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect BlurRadius="25" ShadowDepth="0" Opacity="0.3" Color="#00D9FF"/>
            </Border.Effect>
        </Border>
        
        <!-- Main Card - Glassmorphism -->
        <Border x:Name="CardBorder" Margin="12" CornerRadius="16" ClipToBounds="True"
                BorderBrush="#40FFFFFF" BorderThickness="1">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#35FFFFFF" Offset="0"/>
                    <GradientStop Color="#20FFFFFF" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="44"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Title Bar -->
                <Border Grid.Row="0" Background="#15FFFFFF" BorderBrush="#25FFFFFF" BorderThickness="0,0,0,1"
                        Cursor="SizeAll"
                        MouseLeftButtonDown="TitleBar_MouseLeftButtonDown"
                        MouseMove="TitleBar_MouseMove"
                        MouseLeftButtonUp="TitleBar_MouseLeftButtonUp">
                    <Border.InputBindings>
                        <MouseBinding MouseAction="LeftDoubleClick" Command="{x:Static local:BrowserCard.FullscreenCommand}"/>
                    </Border.InputBindings>
                    <Grid Margin="10,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Navigation Buttons -->
                        <Button x:Name="BackButton" Grid.Column="0" 
                                Style="{StaticResource MaterialDesignIconButton}"
                                Click="BackButton_Click" ToolTip="Back"
                                Width="30" Height="30" Padding="2" Foreground="#B0FFFFFF">
                            <materialDesign:PackIcon Kind="ChevronLeft" Width="18" Height="18"/>
                        </Button>
                        <Button x:Name="ForwardButton" Grid.Column="1"
                                Style="{StaticResource MaterialDesignIconButton}"
                                Click="ForwardButton_Click" ToolTip="Forward"
                                Width="30" Height="30" Padding="2" Foreground="#B0FFFFFF">
                            <materialDesign:PackIcon Kind="ChevronRight" Width="18" Height="18"/>
                        </Button>
                        <Button x:Name="RefreshButton" Grid.Column="2"
                                Style="{StaticResource MaterialDesignIconButton}"
                                Click="RefreshButton_Click" ToolTip="Refresh"
                                Width="30" Height="30" Padding="2" Margin="0,0,8,0" Foreground="#B0FFFFFF">
                            <materialDesign:PackIcon Kind="Refresh" Width="16" Height="16"/>
                        </Button>
                        
                        <!-- URL Bar -->
                        <Border Grid.Column="3" Background="#20FFFFFF" CornerRadius="8" Margin="0,6"
                                BorderBrush="#30FFFFFF" BorderThickness="1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <materialDesign:PackIcon Kind="Web" Grid.Column="0" 
                                                         Width="14" Height="14"
                                                         VerticalAlignment="Center" Margin="10,0,6,0"
                                                         Foreground="#70FFFFFF"/>
                                <TextBlock x:Name="UrlTextBlock" Grid.Column="1" 
                                         VerticalAlignment="Center"
                                         Padding="0,6,12,6" FontSize="12"
                                         Foreground="#E0FFFFFF"
                                         TextTrimming="CharacterEllipsis"
                                         ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>
                            </Grid>
                        </Border>
                        
                        <!-- Bookmark Button -->
                        <Button x:Name="BookmarkButton" Grid.Column="4"
                                Style="{StaticResource MaterialDesignIconButton}"
                                Click="BookmarkButton_Click" ToolTip="Bookmark"
                                Width="30" Height="30" Padding="2" Margin="8,0,0,0" Foreground="#FFA502">
                            <materialDesign:PackIcon x:Name="BookmarkIcon" Kind="StarOutline" Width="16" Height="16"/>
                        </Button>
                        
                        <!-- Close Button -->
                        <Button x:Name="CloseButton" Grid.Column="5"
                                Style="{StaticResource MaterialDesignIconButton}"
                                Click="CloseButton_Click" ToolTip="Close"
                                Width="30" Height="30" Padding="2" Foreground="#FF6B6B">
                            <materialDesign:PackIcon Kind="Close" Width="16" Height="16"/>
                        </Button>
                    </Grid>
                </Border>
                
                <!-- WebView2 Content -->
                <wv2:WebView2 x:Name="WebView" Grid.Row="1"/>
            </Grid>
        </Border>

        <!-- Connection Points Overlay -->
        <Grid x:Name="ConnectionOverlay" Margin="12" Visibility="Collapsed" Panel.ZIndex="20">
            <Grid.Resources>
                <Style x:Key="ConnectionPointStyle" TargetType="Border">
                    <Setter Property="Width" Value="14"/>
                    <Setter Property="Height" Value="14"/>
                    <Setter Property="CornerRadius" Value="7"/>
                    <Setter Property="Background" Value="#50FFFFFF"/>
                    <Setter Property="BorderBrush" Value="#70FFFFFF"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="Opacity" Value="0.9"/>
                    <Setter Property="Cursor" Value="Cross"/>
                    <Setter Property="HorizontalAlignment" Value="Center"/>
                    <Setter Property="VerticalAlignment" Value="Center"/>
                    <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#00D9FF"/>
                            <Setter Property="BorderBrush" Value="#00D9FF"/>
                            <Setter Property="Opacity" Value="1"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Grid.Resources>

            <Border Style="{StaticResource ConnectionPointStyle}" Tag="top"
                    VerticalAlignment="Top" HorizontalAlignment="Center" Margin="0,-6,0,0"
                    MouseLeftButtonDown="ConnectionPoint_MouseLeftButtonDown"
                    MouseEnter="ConnectionPoint_MouseEnter"
                    MouseLeave="ConnectionPoint_MouseLeave"/>

            <Border Style="{StaticResource ConnectionPointStyle}" Tag="right"
                    VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,-6,0"
                    MouseLeftButtonDown="ConnectionPoint_MouseLeftButtonDown"
                    MouseEnter="ConnectionPoint_MouseEnter"
                    MouseLeave="ConnectionPoint_MouseLeave"/>

            <Border Style="{StaticResource ConnectionPointStyle}" Tag="bottom"
                    VerticalAlignment="Bottom" HorizontalAlignment="Center" Margin="0,0,0,-6"
                    MouseLeftButtonDown="ConnectionPoint_MouseLeftButtonDown"
                    MouseEnter="ConnectionPoint_MouseEnter"
                    MouseLeave="ConnectionPoint_MouseLeave"/>

            <Border Style="{StaticResource ConnectionPointStyle}" Tag="left"
                    VerticalAlignment="Center" HorizontalAlignment="Left" Margin="-6,0,0,0"
                    MouseLeftButtonDown="ConnectionPoint_MouseLeftButtonDown"
                    MouseEnter="ConnectionPoint_MouseEnter"
                    MouseLeave="ConnectionPoint_MouseLeave"/>
        </Grid>
        
        <!-- Resize Handles (outside card for better mouse capture) -->
        <Rectangle x:Name="ResizeHandleW" Width="12" HorizontalAlignment="Left" VerticalAlignment="Stretch"
                   Fill="Transparent" Cursor="SizeWE" Margin="0,20,0,20"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"
                   MouseMove="ResizeHandle_MouseMove" MouseLeftButtonUp="ResizeHandle_MouseLeftButtonUp"/>
        <Rectangle x:Name="ResizeHandleE" Width="12" HorizontalAlignment="Right" VerticalAlignment="Stretch"
                   Fill="Transparent" Cursor="SizeWE" Margin="0,20,0,20"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"
                   MouseMove="ResizeHandle_MouseMove" MouseLeftButtonUp="ResizeHandle_MouseLeftButtonUp"/>
        <Rectangle x:Name="ResizeHandleN" Height="12" HorizontalAlignment="Stretch" VerticalAlignment="Top"
                   Fill="Transparent" Cursor="SizeNS" Margin="20,0,20,0"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"
                   MouseMove="ResizeHandle_MouseMove" MouseLeftButtonUp="ResizeHandle_MouseLeftButtonUp"/>
        <Rectangle x:Name="ResizeHandleS" Height="12" HorizontalAlignment="Stretch" VerticalAlignment="Bottom"
                   Fill="Transparent" Cursor="SizeNS" Margin="20,0,20,0"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"
                   MouseMove="ResizeHandle_MouseMove" MouseLeftButtonUp="ResizeHandle_MouseLeftButtonUp"/>
        
        <!-- Corner Handles -->
        <Rectangle x:Name="ResizeHandleNW" Width="16" Height="16" HorizontalAlignment="Left" VerticalAlignment="Top"
                   Fill="Transparent" Cursor="SizeNWSE"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"
                   MouseMove="ResizeHandle_MouseMove" MouseLeftButtonUp="ResizeHandle_MouseLeftButtonUp"/>
        <Rectangle x:Name="ResizeHandleNE" Width="16" Height="16" HorizontalAlignment="Right" VerticalAlignment="Top"
                   Fill="Transparent" Cursor="SizeNESW"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"
                   MouseMove="ResizeHandle_MouseMove" MouseLeftButtonUp="ResizeHandle_MouseLeftButtonUp"/>
        <Rectangle x:Name="ResizeHandleSW" Width="16" Height="16" HorizontalAlignment="Left" VerticalAlignment="Bottom"
                   Fill="Transparent" Cursor="SizeNESW"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"
                   MouseMove="ResizeHandle_MouseMove" MouseLeftButtonUp="ResizeHandle_MouseLeftButtonUp"/>
        <Rectangle x:Name="ResizeHandleSE" Width="16" Height="16" HorizontalAlignment="Right" VerticalAlignment="Bottom"
                   Fill="Transparent" Cursor="SizeNWSE"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"
                   MouseMove="ResizeHandle_MouseMove" MouseLeftButtonUp="ResizeHandle_MouseLeftButtonUp"/>
    </Grid>
</UserControl>
